**Proposal: The R&D grant is for studying a surplus-capturing AMM. The study will evaluate the economic viability and practicality of an AMM that is able to capture surplus in the form of better pricing for COW users and offering LPs to provide liquidity for these orders without LVR loss.**

  
###  Background

The proposal builds on -and is the continuation of- a discussion in the COW forum started by @fluepold [here](https://forum.cow.fi/t/cow-native-amms-aka-surplus-capturing-amms-with-single-price-clearing/1219) and is a continuation of a line of enquiry started on ethresearch forum about MEV-capturing AMMs. Both discussions surfaced exciting prospects for a surplus-capturing AMM design that achieves better prices for users and an improved overall return profile for LPs than traditional AMMs on the whole.

### The surplus Distribution Problem

Traditional CFMMs , by smart contract design, require users to interact with them to update prices. This allows for LPs on CFMMs to leak value due to adverse selection because they cannot feasibly update their quotes as fast as high-frequency swappers. Recent academic [research](https://arxiv.org/abs/2208.06046) has provided a way to formally quantify these losses as "loss-versus rebalancing" (LVR): the difference in value between actual CFMM reserves and a hypothetical ideal "rebalancing strategy" which tracks the same portfolio makeup by trading at a price quoted by an external market rather than the (stale) CFMM price.

An AMM that quotes prices provided by a "perfect" high-frequency price oracle while at the same time maintaining portfolio balance would exactly simulate the rebalancing portfolio and hence eliminate losses due to adverse selection. This would open up the potential for new models of distributing value among LPs and active traders. 

The hypothesis of this study is that COW solvers offer this zero arb price in the market occasionally for new orders thereby simulating the rebalancing portfolio. This allows for LVR to be captured for those specific orders and hence the name: surplus-capturing. Fortunately, this surplus can be captured by COW users and LPs but not the external arbitrageurs. The design of the AMM should allow for the surplus to be split between users and LPs in any fraction desired by the AMM designer. 

### Goals

The aim of this proposal is to act as a “feasibility study” for implementing surplus-capturing AMMs. This project aims to:  
  

-   Evaluate the extent to which this idealised AMM could be approximated in practice by using the CoW solver price as a price oracle.
    
-   Quantify, through empirical studies, the excess value that could be captured and and delivered to LPs and users through this mechanism.

-   Evaluate various mechanisms for implementation. 

    

### Research Methodology

1.  Conduct a theoretical analysis of the potential size of the surplus that can be captured by a surplus-capturing AMM and develop a quantitative model to estimate this surplus.  
    
2.  Compare the portfolio metrics of LPs in a surplus-capturing AMM to those in a traditional AMM using historical market data. This will involve calculating metrics such as return on investment, Sharpe ratio, and volatility for LPs in both types of AMMs.  
      
3.  Conduct simulations and/or experiments to evaluate the potential MEV savings for users of a surplus-capturing AMM compared to a traditional AMM. This will involve implementing the AMM in a controlled environment and collecting data on the MEV savings generated by the AMM under different market conditions and user behaviors.  
    
4.  Evaluate the use of COW solvers as an approximation of the zero-arbitrage price of the market by comparing the performance of COW solvers to other approaches for estimating this price. This involves studying how changes to COW batch times and the increasing role of builders and searchers impact this accuracy.  
      
5.  Investigate the mechanisms for splitting the surplus between users and LPs, and the best tools for the Surplus-capturing AMM builder to use. 

    
6.  In order to ensure the validity and reliability of the results, the proposed methodology will involve a combination of theoretical analysis, mathematical modelling, and empirical studies. Data will be collected from real-world markets, on-chain data, COW Swap trades, AMM trades. Experiments will be conducted in controlled environments to simulate the behaviour of the AMM under different conditions. 

	

    
### Plan & Deliverables

#### Deliverable

 A report with the results of the research, as well as an open-source repository containing the code used for quantitative models.

####  Team: 
**Andrew** : PHD Mathematics (Geometry). [MEV research](https://github.com/flashbots/mev-research/blob/main/FRPs/active/FRP-22.md). [Personal Website](https://awmacpherson.com/)  
**Evan**: Mathematician. Data scientist. AMM researcher. [Personal Blog](https://mirror.xyz/evandekim.eth/kowg_VFD7lp5p12C4wcytc2rooVXgKnUwBd-KUKtndQ)  
**Mohammed**: Electrical/Electronics Engineer. MSc Economics. Crypto Algorithmic trading/ Market making. ETH Arabia.   

#### Timeline:

Duration: 6 weeks

Week 1-2: Conduct theoretical analysis and develop quantitative model to estimate surplus capture potential. Conduct simulations or experiments to evaluate MEV savings for users of surplus-capturing AMM

Week 3-4: Compare portfolio metrics of LPs in surplus-capturing AMM to traditional AMM using historical market data. Evaluate performance of COW solvers for estimating zero-arbitrage price

Week 5: Investigate mechanisms for splitting surplus and evaluate potential benefits and challenges. Conduct additional simulations or experiments as needed to further assess performance of surplus-capturing AMM. 

Week 6: Complete research paper writeup. 


#### Grant Detais: 
15k USDC + 180k COW 

Evaluation: 60% FTE evaluated on median US salary for 6 week duration. 

Upfront: 15k USDC   
Upon Completion: 180k COW

  
## Further Milestones 

Phase 1: Research 
The proposal detailed above can be considered a phase 1 in the road to having a fully functioning surplus-capturing AMM which produces a report detailing the economics and design considerations. This should lay the groundwork for a prototype to be built. 

Phase2: Prototype
The prototype phase can be thought of as a seperate proposal in itself with a team enhanced with the skills necessary to complete a prototype and a prelimenary design spec submitted to the COW committee for review. The intention is to organize an in person hackathon to build a prototype to produce an prototype in the most efficient way and quickest way possible. Details will follow towards the end of phase1.  


### References

-   Price volatility impact on LPs studied by Milionis et al. in LVR (paper titled: Automated Market Making and Loss-Versus-Rebalancing) ([https://arxiv.org/abs/2208.06046](https://arxiv.org/abs/2208.06046))
    
-   Presentations by authors discussing LVR further ([https://www.youtube.com/watch?v=G8qxxlqvMBk](https://www.youtube.com/watch?v=G8qxxlqvMBk)) ([https://www.youtube.com/watch?v=q5vyJJb-Uyw&list=PLEGCF-WLh2RK2Cym4ZeEWDOSlmirXWtZO&index=34](https://www.youtube.com/watch?v=q5vyJJb-Uyw&list=PLEGCF-WLh2RK2Cym4ZeEWDOSlmirXWtZO&index=34))
    
-   Surplus capturing AMM can be traced back to research proposal on MEV-capturing AMM designs ([https://ethresear.ch/t/mev-capturing-amm-mcamm/13336/22](https://ethresear.ch/t/mev-capturing-amm-mcamm/13336/22)) ([https://ethresear.ch/t/mev-minimizing-amm-minmev-amm/13775](https://ethresear.ch/t/mev-minimizing-amm-minmev-amm/13775))
    
-   Paper provides formal specification of implementation of MEV-capturing AMM ([https://arxiv.org/pdf/2210.10601.pdf](https://arxiv.org/pdf/2210.10601.pdf))
    
-   Paper details math behind using external price oracle in standard CPMM ([https://anrg.usc.edu/www/papers/dynamicautomation.pdf](https://anrg.usc.edu/www/papers/dynamicautomation.pdf))
    
-   Forum proposal continues ideas on McAMMs, using fees as main tool for capturing LVR for LPs ([https://ethresear.ch/t/dynamic-mev-capturing-amm-dmcamm/13849](https://ethresear.ch/t/dynamic-mev-capturing-amm-dmcamm/13849))


