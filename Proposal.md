**Proposal: The R&D grant is for studying a surplus-capturing AMM. The study will evaluate the economic viability and practicality of an AMM is able to capture surplus in the form of better pricing for COW users and offering LPs to provide liquidity for these orders without LVR loss.**

  
###  Background

The proposal builds on -and is the continuation of- a discussion in the COW forum started by @fluepold [here](https://forum.cow.fi/t/cow-native-amms-aka-surplus-capturing-amms-with-single-price-clearing/1219) and is a continuation of a line of enquiry started on ethresearch forum about MEV-capturing AMMs. Both discussions surfaced exciting prospects for a surplus-capturing AMM design that achieves better prices for users and an improved overall return profile for LPs than traditional AMMs on the whole.

### The surplus Distribution Problem

Traditional CFMMs require ‘users’ to interact with them to update prices given their smart contract nature. This allows for LPs on CFMMs to leak value due to adverse selection because they cannot feasibly update their quotes as fast as high-frequency swappers. Recent academic research [citation] has provided a way to formally quantify these losses as "loss-versus rebalancing" (LVR): the difference in value between actual CFMM reserves and a hypothetical ideal "rebalancing strategy" which tracks the same portfolio makeup by trading at a price quoted by an external market rather than the (stale) CFMM price.

An AMM that quotes prices provided by a "perfect" high-frequency price oracle while at the same time maintaining portfolio balance would exactly simulate the rebalancing portfolio and hence eliminate losses due to adverse selection. This would open up the potential for new models of distributing value among LPs and active traders. 

The hypothesis of this study is that COW solvers offer this zero arb price in the market occasionally for new orders thereby simulating the rebalancing portfolio.. This allows for LVR to be captured for those specific orders and hence the name: surplus-capturing. This surplus captured by COW users and LPs but not the external arbitrageurs. Given the design of the AMM surplus can be split between users and LPs in any fraction desired.

### Goals

The aim of this proposal is to act as a “feasibility study” for implementing surplus-capturing AMMs. This project aims to:  
  

-   Evaluate the extent to which this idealised AMM could be approximated in practice by using the CoW solver price as a price oracle.
    
-   Quantify, through empirical studies, the excess value that could be captured and and delivered to LPs and users through this mechanism.
    

### Methodology

1.  Conduct a theoretical analysis of the potential size of the surplus that can be captured by a surplus-capturing AMM and develop a quantitative model to estimate this surplus.  
    
2.  Compare the portfolio metrics of LPs in a surplus-capturing AMM to those in a traditional AMM using historical market data. This will involve calculating metrics such as return on investment, Sharpe ratio, and volatility for LPs in both types of AMMs.  
      
3.  Conduct simulations or experiments to evaluate the potential MEV savings for users of a surplus-capturing AMM compared to a traditional AMM. This will involve implementing the AMM in a controlled environment and collecting data on the MEV savings generated by the AMM under different market conditions and user behaviors.  
    
4.  Evaluate the use of COW solvers as an approximation of the zero-arbitrage price of the market by comparing the performance of COW solvers to other approaches for estimating this price. This involves studying how changes to COW batch times and the increasing role of builders and searchers impact this accuracy.  
      
5.  Investigate mechanisms for splitting the surplus between users and LPs, such as auction-based approaches or fixed-rate allocations, and evaluate the potential benefits and challenges of these mechanisms. This will involve conducting simulations or experiments to assess the performance of these mechanisms under various market conditions. 
    
6.  In order to ensure the validity and reliability of the results, the proposed methodology will involve a combination of theoretical analysis, mathematical modeling, and empirical studies. Data will be collected from real-world markets and experiments will be conducted in controlled environments to simulate the behavior of the AMM under different conditions.
    

### Plan & Deliverables

#### Deliverable
 A report with the results of the research, as well as an open-source repository containing the code used for quantitative models.

####  Team: 
**Andrew** : PHD Math. MEV research (Flashbots). https://awmacpherson.com/  
**Evan**: Mathematician. Data scientist. AMM researcher. [https://mirror.xyz/evandekim.eth/kowg_VFD7lp5p12C4wcytc2rooVXgKnUwBd-KUKtndQ](https://mirror.xyz/evandekim.eth/kowg_VFD7lp5p12C4wcytc2rooVXgKnUwBd-KUKtndQ "https://mirror.xyz/evandekim.eth/kowg_VFD7lp5p12C4wcytc2rooVXgKnUwBd-KUKtndQ")   
**Mohammed**: Electrical Engineer. Economics. Modelling. Trading.

#### Timeline:

Duration: 9-12 weeks

Month 1:  
Conduct theoretical analysis and develop quantitative model to estimate surplus capture potential. Conduct simulations or experiments to evaluate MEV savings for users of surplus-capturing AMM

Month 2:  
Compare portfolio metrics of LPs in surplus-capturing AMM to traditional AMM using historical market data. Evaluate performance of COW solvers for estimating zero-arbitrage price

Month 3: Investigate mechanisms for splitting surplus and evaluate potential benefits and challenges. Conduct additional simulations or experiments as needed to further assess performance of surplus-capturing AMM. Complete research paper writeup and publish


#### Grant: 
45k (Mix of COW and USDC)

Evaluated at 50% Full Time Equivalant + Expenses.

  

### References

-   Price volatility impact on LPs studied by Milionis et al. in LVR (paper titled: Automated Market Making and Loss-Versus-Rebalancing) ([https://arxiv.org/abs/2208.06046](https://arxiv.org/abs/2208.06046))
    
-   Presentations by authors discussing LVR further ([https://www.youtube.com/watch?v=G8qxxlqvMBk](https://www.youtube.com/watch?v=G8qxxlqvMBk)) ([https://www.youtube.com/watch?v=q5vyJJb-Uyw&list=PLEGCF-WLh2RK2Cym4ZeEWDOSlmirXWtZO&index=34](https://www.youtube.com/watch?v=q5vyJJb-Uyw&list=PLEGCF-WLh2RK2Cym4ZeEWDOSlmirXWtZO&index=34))
    
-   Surplus capturing AMM can be traced back to research proposal on MEV-capturing AMM designs ([https://ethresear.ch/t/mev-capturing-amm-mcamm/13336/22](https://ethresear.ch/t/mev-capturing-amm-mcamm/13336/22)) ([https://ethresear.ch/t/mev-minimizing-amm-minmev-amm/13775](https://ethresear.ch/t/mev-minimizing-amm-minmev-amm/13775))
    
-   Paper provides formal specification of implementation of MEV-capturing AMM ([https://arxiv.org/pdf/2210.10601.pdf](https://arxiv.org/pdf/2210.10601.pdf))
    
-   Paper details math behind using external price oracle in standard CPMM ([https://anrg.usc.edu/www/papers/dynamicautomation.pdf](https://anrg.usc.edu/www/papers/dynamicautomation.pdf))
    
-   Forum proposal continues ideas on McAMMs, using fees as main tool for capturing LVR for LPs ([https://ethresear.ch/t/dynamic-mev-capturing-amm-dmcamm/13849](https://ethresear.ch/t/dynamic-mev-capturing-amm-dmcamm/13849))

